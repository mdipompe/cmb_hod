<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 7.1 (456449)"/><meta name="altitude" content="176.2594604492188"/><meta name="author" content="mdipompe@gmail.com"/><meta name="created" content="2018-04-30 15:27:48 +0000"/><meta name="latitude" content="43.70525885117417"/><meta name="longitude" content="-72.28655459142983"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2018-05-02 14:58:23 +0000"/><title>CMB HOD - Notes for Ryan</title></head><body><div><span style="font-weight: bold;">Some general points:</span></div><ol><li><div>We are first trying to reproduce the results (figure 1) of Hill &amp; Spergel (2014; <a href="https://arxiv.org/pdf/1312.4525.pdf">https://arxiv.org/pdf/1312.4525.pdf</a>; hereafter H&amp;S14), the cross-correlation between the SZ effect and CMB lensing.</div></li><li><div>To do these calculations, I’ve been working with arrays of M, z, and ell defined to be evenly log-spaced with the following limits: LogM: 5-15.7  (108 points), z: 0.005 - 9.995  (100 point), ell: 1 - 10,000 (1000 point)</div></li><li><div>To improve accuracy of integrals, all functions of M and z are interpolated onto a grid 10 times as dense before integrating.</div></li><li><div>Almost everything makes use of my cosmology common block, initialized with<span style="font-weight: bold;"> load_cosmology.pro</span>. Run this first!</div></li><li><div>Most of the functions are designed to take arrays of masses and redshifts, and return arrays of parameters with the first dimension corresponding to masses, and the second corresponding to redshift. This is to avoid having to loop, but requires lots of use of reform, transpose, and rebin functions.</div></li><li><div>Generally I always work with viral parameters (mass, radius, etc), which can be converted to other definitions using convert_nfw.pro. This is necessary for wrapping in things that were defined in different systems; e.g. the HMF and the SZ pressure profile.</div></li></ol><div><br/></div><div><br/></div><div><span style="font-weight: bold;">Major issues to work out:</span></div><ol><li><div>The normalization factor for a number density fourier transform; i.e. in H&amp;S14, when you put the HOD model into a modified equation 10, what goes in place of the critical surface density for lensing?</div></li><li><div>Why does using M_vir converted to M_200 relative to the mean using the method of H&amp;S not seem to produce close results? Rather, what seems to work is using a re-scaled Delta value in the HMF calculation: <img src="CMB%20HOD%20-%20Notes%20for%20Ryan.resources/66F487C8-B90A-481B-AAD8-DF024A60821D.png" height="148" width="1876"/>, which just reduces down to: <img src="CMB%20HOD%20-%20Notes%20for%20Ryan.resources/C840D19C-0709-4DB0-B1AC-188BDDAC30B2.png" height="66" width="494"/>, if you blur your eyes and assume that the radii cancel...</div></li><li><div>What’s up with the Tinker et al. (2010) HMF normalization? If I force it to normalize to 1, things seem *very* close - but why does this need to be done? Note that e.g. the Sheth, Mo, &amp; Turman HMF doesn’t seem normalized to 1 either, which suggests a bug on my part - but I agree perfectly with HMFCalc.</div></li><li><div>Ignoring the above, when I put the new HOD part in and run things, the 2-halo term I get out doesn’t agree at all with the models from our previous CMB lensing work.</div></li></ol><div><br/></div><div><br/></div><div><span style="font-weight: bold;">Where things stand now:</span></div><div>The final CMB-SZ x-corr is looking pretty good - assuming I hack the HMF to normalize to 1, and don’t convert the masses in the way I think I should. There’s still a slight amplitude offset needed though:</div><div><img src="CMB%20HOD%20-%20Notes%20for%20Ryan.resources/9E865E37-4D4E-4B05-ADFF-77E543095D64.png" height="718" width="1190"/><br/></div><div>y-y autocorrelation looks great this way too (with fudge factor for amplitude):</div><div><img src="CMB%20HOD%20-%20Notes%20for%20Ryan.resources/4BC19A61-6490-4E0B-A969-4AE776B2BC89.png" height="710" width="1188"/><br/></div><div>phi-phi looks pretty good:</div><div><img src="CMB%20HOD%20-%20Notes%20for%20Ryan.resources/04C594DA-3E81-478A-8E34-CE3771DD6444.png" height="712" width="1176"/><br/></div><div><br/></div><div>If I do the mass conversion the way that I think I should though, not as good:</div><div>e.g. y-y autocorr:</div><div><img src="CMB%20HOD%20-%20Notes%20for%20Ryan.resources/8E882E9C-6E90-4C65-8C48-3283515E4685.png" height="526" width="707"/><br/></div><div><br/></div><div>When you try to do the actual model we’re working on (AGN HOD - CMB x-corr), don’t get agreement with previous methods for getting the 2-halo term (red is the old one, dashed is new 1-halo, solid is new 2-halo):</div><div><img src="CMB%20HOD%20-%20Notes%20for%20Ryan.resources/FAD9329F-5E87-4528-8769-C3B87A245ADB.png" height="696" width="1228"/><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">All the details on the pieces of the code:</span></div><div>Basically, you just need to run all the “get_xxx.pro” pieces, which will spit out .sav files of all the parameters.  Then the one_halo.pro and two_halo.pro codes will do the integrals for you. Then your comparison tests can be done with plot_final.pro (to make H&amp;S figure 1), fig_5.pro (to make H&amp;S figure 5), and dcdz.pro (to make H&amp;S figures 3 and 4). Here’s a rundown of each piece, and what lives where.</div><div><br/></div><div><span style="font-weight: bold;">c_index.pro:</span></div><div><img src="CMB%20HOD%20-%20Notes%20for%20Ryan.resources/61A920AD-19FD-4907-A581-72EB4D8095F0.png" height="96" width="286"/><br/></div><div>(Zheng et al. 2007; <a href="http://adsabs.harvard.edu/abs/2007ApJ...667..760Z">http://adsabs.harvard.edu/abs/2007ApJ...667..760Z</a>)</div><div><br/></div><div>This can be used to describe both the dark matter and the galaxy/AGN distribution. My plan was to use the default values from Zheng et al. (2008) for the DM, and a normalization c0=32 for the AGN, based on Richardson et al. (2013; <a href="http://adsabs.harvard.edu/abs/2013ApJ...774..143R">http://adsabs.harvard.edu/abs/2013ApJ...774..143R</a>)</div><div><br/></div><div>I calculated my own value of M* for my cosmology of 3.71535d+12, and use this as the default.</div><div><br/></div><div>You can optionally use the parameterization of Duffy et al. (2008):</div><div><img src="CMB%20HOD%20-%20Notes%20for%20Ryan.resources/36771D97-4B23-46AA-B5F3-8829BDBE60A2.png" height="96" width="360"/><br/></div><div>But this is not a significant effect down the pipe.</div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">convert_nfw.pro</span></div><div>Needed to convert between halo definitions. Input values are viral, and outputs are some factor relative to critical or mean density.</div><div><br/></div><div>If the conversion is from one definition of Delta to another but still relative to critical density, then use the fast conversions in the appendices of: <a href="https://arxiv.org/pdf/astro-ph/0203169.pdf">https://arxiv.org/pdf/astro-ph/0203169.pdf</a></div><div><br/></div><div>If converting to something relative to mean density, have to do a bit more work. Use equation 4 of Hill and Pajer (2013;  <a href="https://arxiv.org/pdf/1303.4726.pdf">https://arxiv.org/pdf/1303.4726.pdf</a>), which I solved analytically so you don’t have to waste computing time doing it numerically.</div><div><img src="CMB%20HOD%20-%20Notes%20for%20Ryan.resources/CBD66821-7096-417E-ADE2-CC7A5558C807.png" height="599" width="929"/><br/></div><div><br/></div><div><span style="font-weight: bold;">cosmocalc.pro</span></div><div>My cosmology calculator. Takes input z (can be array) and gets a bunch of distances</div><div><br/></div><div><b>counter.pro</b></div><div>Just a tool I wrote to print a counter on long loops so you know where your code is.</div><div><br/></div><div><span style="font-weight: bold;">dcdz.pro</span></div><div>Calculate dC/dz of Hill and Spergel et al. (2014), for comparison to their figures 3 and 4.  Requires you to already have run get_hmf, get_b, get_dv, get_phi_y and made the appropriate .sav files.</div><div><br/></div><div><span style="font-weight: bold;">diff_3d.pro</span></div><div>For integrals, need to get spacing across a particular dimension of multi dimensional arrays. Right now this is not very general, but set up to do it in the appropriate dimension for the given situation, based on the size and dimensions of the input. </div><div><br/></div><div><span style="font-weight: bold;">evolve_density.pro</span></div><div>Evolve the current density of either matter or lambda to the specified z. Takes a type keyword, ‘matter’ (default) or ‘lambda’.</div><div><br/></div><div><span style="font-weight: bold;">fig_5.pro</span></div><div>Calculate values to compare to Hill &amp; Spergel (2014) figure 5. Requires you to already have run get_hmf, get_b, get_dv, get_phi_y and made the appropriate .sav files</div><div><br/></div><div><span style="font-weight: bold;">get_b.pro, get_hmf.pro, get_dv.pro</span></div><div>These get the bias (for 2-halo term), HMF, and differential comoving volume element and create .sav files used in other codes for the actual calculations. A lot of testing for issues with the HMF require re-running get_hmf.</div><div><br/></div><div><span style="font-weight: bold;">get_mean_masses.pro</span></div><div>Converts viral masses to masses relative to 200.*rho_mean for HMF calculation (using convert_nfw.pro), and creates a .sav file.  This can be used in get_hmf.pro. Note that currently using these masses gives you an answer with more disagreement from Hill &amp; Spergel than my method of just adjusting Delta, and is a source of much confusion for me.</div><div><br/></div><div><span style="font-weight: bold;">get_phi_gal.pro</span></div><div>Do the Fourier transform of number density profile to get phi_ell for galaxies/AGN (using phi_ell.pro, modified version of H&amp;S Eq 10) and make a .sav file. This is for the real model we want to do, not the test comparing to Hill &amp; Spergel. </div><div><br/></div><div><span style="font-weight: bold;">get_phi_y.pro</span></div><div>Do the Fourier transform of the density profiles to get phi_ell and y_ell values for all M, z, and ell, creating .sav files to use in the integrals (using phi_ell.pro and y_ell.pro).</div><div><br/></div><div><span style="font-weight: bold;">halo_mass_function.pro</span></div><div>Calculate the halo mass function for the given mass, redshift, and cosmology.</div><div><br/></div><div><span style="font-weight: bold;">hod.pro</span></div><div>Gets N(M) in the halo model (see e.g. Richardson et al. (2013) equation 1):</div><div><img src="CMB%20HOD%20-%20Notes%20for%20Ryan.resources/089EDFF3-C303-4B44-B5B7-8C21AACF747F.png" height="90" width="1019"/><br/></div><div>All defaults set to Richardson et al. (2013) fits.</div><div><br/></div><div><span style="font-weight: bold;">int_logm_z.pro</span></div><div>Does M and z integrals as a check of different methods, this time using dNdlogM.</div><div><br/></div><div><span style="font-weight: bold;">mhalo2bias.pro</span></div><div>Converts halo masses to bias (used in get_b.pro).</div><div><br/></div><div><span style="font-weight: bold;">nfw.pro</span></div><div>Get an NFW density profile. Flexible handling of multiple masses, redshifts, and radii. If arrays of each are passed, will return a 3D data cube with dimensions in order of mass, redshift, radius.  Mostly uses equations from NFW 97:</div><div><img src="CMB%20HOD%20-%20Notes%20for%20Ryan.resources/F50EF480-3B6E-491C-AE52-B33118785142.png" height="138" width="394"/>, <img src="CMB%20HOD%20-%20Notes%20for%20Ryan.resources/24CEDCCA-415A-4BAE-AC58-EB159CD841DC.png" height="66" width="212"/><br/></div><div>However, NFW use R_200 as their R_vir. I (and other modern versions), use the viral radius as follows:</div><div><img src="CMB%20HOD%20-%20Notes%20for%20Ryan.resources/691ACDF3-F5FC-4402-8735-BB9730FAAF60.png" height="97" width="457"/><br/></div><div>with </div><div><img src="CMB%20HOD%20-%20Notes%20for%20Ryan.resources/7968227F-8A83-43BA-88F6-10D86F382A7A.png" height="41" width="721"/><br/></div><div>Note that this definition requires a slight tweak to an equation from NFW 97:</div><div><img src="CMB%20HOD%20-%20Notes%20for%20Ryan.resources/8F0DD7CE-0C5E-465C-8EE7-68A1EFF62B1C.png" height="95" width="381"/><br/></div><div>The 200 in the numerator is replaced by the Delta_cr above. </div><div><br/></div><div><span style="font-weight: bold;">one_halo.pro</span></div><div>Using all the .sav files, calculate the one-halo term (Hill &amp; Spergel 2014 equation 8). Spits out a .sav file.</div><div><br/></div><div><span style="font-weight: bold;">phi_ell.pro</span></div><div>Calculate the Fourier transform of an NFW profile (either a DM mass density or a galaxy/AGN number density). Will call nfw.pro to get the profile, you can pass some parameters to tweak.  NOTE: the normalization for a number density is currently set with a fudge factor (100), rather than the critical density for lensing used for a DM density.  This will need to be worked out.</div><div><br/></div><div><span style="font-weight: bold;">plot_final.pro</span></div><div>Make the final plot (Fig 1 of Hill &amp; Spergel) of the 1 and 2-halo terms, and compare to the data from the paper that I digitized.</div><div><br/></div><div><span style="font-weight: bold;">rho_crit.pro</span></div><div>Get critical density at any z. Still not 100% sure when I need to be using the /physical flag and not. I usually don’t, unless I’m trying to get the mean matter density at all z to be constant.</div><div><br/></div><div><span style="font-weight: bold;">r_vir.pro</span></div><div>Get halo viral radius for any combination of log(M) and z. Flexible handling of dimensionality depending on what is provided.</div><div><br/></div><div><span style="font-weight: bold;">sigma_crit_lens</span></div><div>Gets the critical surface density for lensing at redshift z, assuming source is the CMB (Hill &amp; Spergel 2014 equation 6)</div><div><br/></div><div><span style="font-weight: bold;">sigma_m.pro</span></div><div>Gets the mass variance. Really only needed for calculating mstar in the concentration index equations, and maybe some power spectrum/HMF checks.</div><div><br/></div><div><span style="font-weight: bold;">sz_pressure.pro</span></div><div>Gets the electron pressure as a function of radius of a DM halo, following Battaglia et al. (2012; <a href="http://iopscience.iop.org/article/10.1088/0004-637X/758/2/75/pdf">http://iopscience.iop.org/article/10.1088/0004-637X/758/2/75/pdf</a>).  Flexible handling of multiple masses, redshifts, and radii. </div><div><br/></div><div><span style="font-weight: bold;">two_halo.pro</span></div><div>Using all the .sav files, calculate the two-halo term (Hill &amp; Spergel 2014 equation 11). Spits out a .sav file.</div><div><br/></div><div><span style="font-weight: bold;">y_ell.pro</span></div><div>Calculate the Fourier transform of an SZ pressure profile. Will call sz_pressure.pro to get the profile, you can pass some parameters to tweak.  </div><div><br/></div><div><span style="font-weight: bold;">test_xxx.pro</span></div><div>Some tests I’ve thrown at all the different pieces...</div><div><br/></div><div>Other files:</div><div><span style="font-weight: bold;">dndm_norm.txt</span> - normalizations at each redshift for the HMF, setup specifically so that the integral of b(nu)*f(nu) of Tinker et al. (2010) is forced to one (see check_hmf/test_tinker directory).</div><div><br/></div><div><br/></div><div>Other directories:</div><div><span style="font-weight: bold;">agn_cmb_xcorr/</span></div><div>In here I started doing the actual model of the AGN-CMB x-corr 1-halo term, instead of reproducing the CMB-SZ x-corr. Basically I just ran get_phi_gal.pro (above) to make some .sav files and started comparing, but didn’t make it very far.</div><ul><li><div><span style="font-weight: bold;">all_dndz.txt: </span>List of redshifts for WISE AGN in the Bootes field, for getting dNdz.</div></li><li><div><span style="font-weight: bold;">c_l_1h/2h.sav: </span>.sav files of the 1 and 2 halo terms generated by one_halo.pro and two_halo.pro</div></li><li><div><span style="font-weight: bold;">compare.pro: </span>Compare the 1/2 halo terms generated here with the model we used previously in e.g. DiPompeo et al. (2017). They don’t match at all.</div></li><li><div><span style="font-weight: bold;">dcdz.pro: </span>Do the mass integral and compute dC/dz.</div></li><li><div><span style="font-weight: bold;">dipompeo_2017_xcorr_model.txt: </span>The data for the old model for comparison</div></li><li><div><span style="font-weight: bold;">dndm_norm.txt: </span>The mass function renormalization hack (same as above).</div></li><li><div><span style="font-weight: bold;">dndz_fit.txt: </span>The fit to the dNdz of the WISE AGN generated by fit_dndz.pro </div></li><li><div><span style="font-weight: bold;">fig_5.pro: </span>Generate H&amp;S2014 figure 5 for the new model.</div></li><li><div><span style="font-weight: bold;">fit_dndz.pro:</span> Code I wrote to fit a histogram of z values to estimate dndz.  Run inside the one_halo.pro and two_halo.pro codes.</div></li><li><div><span style="font-weight: bold;">one_halo/two_halo.pro: </span>Do the integrals to get the one and two halo terms of the new model, using the .sav files for each parameter.</div></li><li><div><span style="font-weight: bold;">plot_final.pro </span>Make figure 1 of Hill &amp; Spergel, for the new model</div></li></ul><div><br/></div><div><span style="font-weight: bold;">test_tinker_hmf/</span></div><div>Some tests of the halo mass function and it’s normalization. <span style="font-style: italic;">This is one big area of concern</span></div><ul><li><div><span style="font-weight: bold;">bias2mhalo.pro: </span>Converts a bias factor to halo mass</div></li><li><div><span style="font-weight: bold;">get_norm.pro: </span>gets re-normalization at each redshift so integral of f(nu)*b(nu) is actually 1.</div></li><li><div><span style="font-weight: bold;">halo_mass_function.pro: </span>modified version of my HMF calculator that returns nu and f (instead of dNdm)</div></li><li><div><span style="font-weight: bold;">mhalo2bias.pro: </span>modified version of code that returns nu and bias, instead of just bias (for testing)</div></li><li><div><span style="font-weight: bold;">test.pro: </span>Does some tests comparing my HMF calculation and that of HMFCalc</div></li><li><div><span style="font-weight: bold;">hmfcalc/</span></div></li><ul><li><div>Tinker et al (2010) HMFs at my redshifts using HMFCalc python code (<a href="https://github.com/steven-murray/hmf">https://github.com/steven-murray/hmf</a>)</div></li><li><div><span style="font-weight: bold;">hmf_test.py</span>: Runs HMF to get all the HMFcalc files</div></li><li><div><span style="font-weight: bold;">convert_py2idl.pro:</span> Reads in all the .txt files from HMFCalc, puts into a .sav file for IDL.</div></li></ul></ul><div><br/></div><div><span style="font-weight: bold;">hill_spergel_data/</span></div><div>Contains data I digitized from a bunch of plots in the H&amp;S 2014 paper, for comparisons.</div><div><br/></div><div><span style="font-weight: bold;">power_spec/</span></div><div>This is where the linear power spectra at each redshift are created and stored, for e.g. the HMF and the 2-halo term. </div><ul><li><div><span style="font-weight: bold;">make_power_spec.pro: </span>This uses my code camb4idl (<a href="https://github.com/mdipompe/camb4idl">https://github.com/mdipompe/camb4idl</a>) to generate P(k) at each z, starting with the parameter file default_params.ini</div></li><li><div><span style="font-weight: bold;">convert_pspec.pro: </span>Takes each P(k), and converts to P(ell). Involves extrapolating the linear part out to the necessary ell.</div></li></ul><div><br/></div><div><span style="font-weight: bold;">sav_data/</span></div><div>Most of the codes above spit out .sav files of parameters into this directory.  Files with “_interp” appended have been interpolated onto a finer grid in mass (but not z), for improved integration accuracy. Almost all are 2d arrays for each M and z value, or 3D for each M, z, and ell.</div><ul><li><div><b>Mvir_Mmean200.sav: </b>Virial and corresponding 200*rho_mean defined halo masses. Should use for input to HMF calculation, but seems to make results disagree more...</div></li><li><div><b>bias.sav: </b>Bias values calculated with virial masses adjusted by re-scaled Delta values to approximate the 200*rho_mean values.</div></li><li><div><b>bias_converted_m.sav: </b>Bias values calculated using masses converted to 200*rho_mean definition</div></li><li><div><b>dndlogm.sav: </b>HMF in dNdlogM units, for testing integration.</div></li><li><div><b>dndm.sav: </b>HMF calculated using virial masses adjusted by re-scaled Delta values to approximate the 200*rho_mean values.</div></li><li><div><b>dndm_converted_m.sav:</b> HMF calculated using 200*rho_mean masses from convert_nfw.pro</div></li><li><div><b>dndm_hmfcalc.sav: </b>HMF from the python HMFcalc code, as a test. These are super similar to mine and don’t seem to impact the results significantly.</div></li><li><div><b>dndm_renorm.sav: </b>HMF calculated using a forced re-normalization so that b(nu)*f(nu)=1</div></li><li><div><b>dv.sav: </b>Differential co-moving volume element at each z. Note the “_interp” version is interpolated already to finer grid in z.</div></li><li><div><b>p_ell.sav: </b>Power spectrum as a function of ell for each z.</div></li><li><div><b>phi_gal_mz.sav: </b>Fourier transform of the galaxy/AGN distribution (phi_ell) based on the HOD.</div></li></ul><ul><li><div><b>phi_y_mz.sav: </b>Fourier transform of the NFW profile (phi_ell) and SZ pressure (y_ell).</div></li></ul><div><br/></div><div><span style="font-weight: bold;">sz_data/</span></div><div>Data digitized for checks on the SZ pressure profile (figure 1: <a href="http://iopscience.iop.org/article/10.1088/0004-637X/758/2/75/pdf">http://iopscience.iop.org/article/10.1088/0004-637X/758/2/75/pdf</a>).</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></body></html>